<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="description" content="香港霓虹灯AR 2.0 - 留住消失中的光影">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>香港霓虹灯 AR 2.0</title>

    <!-- OpenType.js for Chinese text -->
    <script src="https://cdn.jsdelivr.net/npm/opentype.js@1.3.4/dist/opentype.min.js"></script>

    <!-- Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <!-- AR.js - Multiple CDN sources for fallback -->
    <script src="https://unpkg.com/ar.js@3.4.5/build/ar.js"></script>
    <script>
        // 如果第一个CDN失败，尝试备用源
        if (typeof THREEx === 'undefined') {
            var script = document.createElement('script');
            script.src = 'https://cdn.jsdelivr.net/npm/ar.js@3.4.5/build/ar.js';
            document.head.appendChild(script);
        }
    </script>

    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Toast 提示 -->
    <div id="toast"></div>

    <!-- 主容器 -->
    <div class="container">
        <!-- 启动屏幕 -->
        <div id="start-screen" class="screen active">
            <header class="app-header">
                <div class="app-title">香港·霓虹</div>
                <button id="settings-trigger" class="icon-btn" title="设置">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"></circle>
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                    </svg>
                </button>
            </header>

            <main class="start-content">
                <div class="hero-title neon-text">香港霓虹灯 AR</div>
                <p class="hero-subtitle">留住·消失中的光影</p>

                <div class="mode-selector">
                    <button class="mode-btn neon-mode-btn" data-mode="neon">
                        <div class="mode-icon">💡</div>
                        <div class="mode-name">霓虹灯文字</div>
                        <div class="mode-desc">生成发光霓虹灯招牌</div>
                    </button>
                    <button class="mode-btn graffiti-mode-btn" data-mode="graffiti">
                        <div class="mode-icon">🎨</div>
                        <div class="mode-name">AI 涂鸦</div>
                        <div class="mode-desc">AI生成创意涂鸦</div>
                    </button>
                    <button class="mode-btn preview-mode-btn" data-mode="preview">
                        <div class="mode-icon">🖼️</div>
                        <div class="mode-name">桌面预览</div>
                        <div class="mode-desc">无需摄像头，直接预览</div>
                    </button>
                </div>
            </main>

            <footer class="app-footer">
                <p class="copyright">香港霓虹灯文化传承计划</p>
            </footer>
        </div>

        <!-- 霓虹灯输入屏幕 -->
        <div id="neon-input" class="screen">
            <header class="screen-header">
                <button class="back-btn" data-screen="start-screen">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 12H5M12 19l-7-7 7-7"/>
                    </svg>
                </button>
                <h1>霓虹灯文字</h1>
                <div class="spacer"></div>
            </header>

            <main class="input-content">
                <div class="input-group">
                    <label for="neon-text">输入文字（最多10字）</label>
                    <input type="text" id="neon-text" maxlength="10" placeholder="如：香港·霓虹" autocomplete="off">
                </div>

                <div class="input-group">
                    <label>选择霓虹色</label>
                    <div id="neon-colors" class="color-selector">
                        <!-- 颜色按钮由JS生成 -->
                    </div>
                </div>

                <button id="neon-generate-btn" class="primary-btn">
                    <span>生成霓虹灯</span>
                </button>
            </main>
        </div>

        <!-- 霓虹灯预览屏幕 -->
        <div id="neon-preview-screen" class="screen">
            <header class="screen-header">
                <button id="neon-back-btn" class="back-btn">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 12H5M12 19l-7-7 7-7"/>
                    </svg>
                </button>
                <h1>预览</h1>
                <div class="spacer"></div>
            </header>

            <main class="preview-content">
                <div id="neon-preview-container" class="preview-container">
                    <canvas id="neon-canvas"></canvas>
                </div>

                <div class="action-buttons">
                    <button id="neon-preview-btn" class="secondary-btn">
                        <span class="btn-icon">🖼️</span>
                        <span>桌面预览</span>
                    </button>
                    <button id="neon-ar-btn" class="ar-btn">
                        <span class="btn-icon">📷</span>
                        <span>AR模式</span>
                    </button>
                </div>
            </main>
        </div>

        <!-- AI涂鸦输入屏幕 -->
        <div id="graffiti-input" class="screen">
            <header class="screen-header">
                <button class="back-btn" data-screen="start-screen">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 12H5M12 19l-7-7 7-7"/>
                    </svg>
                </button>
                <h1>AI 涂鸦</h1>
                <div class="spacer"></div>
            </header>

            <main class="input-content">
                <div class="input-group">
                    <label for="graffiti-prompt">描述你的涂鸦（中英文皆可）</label>
                    <textarea id="graffiti-prompt" rows="3" maxlength="100" placeholder="如：一只赛博朋克风格的猫"></textarea>
                </div>

                <div class="input-group">
                    <label>选择风格</label>
                    <div id="graffiti-styles" class="style-selector">
                        <button class="style-btn selected" data-style="cyberpunk">
                            <span class="style-preview" style="background: linear-gradient(45deg, #ff00ff, #00ffff);"></span>
                            <span class="style-name">赛博朋克</span>
                        </button>
                        <button class="style-btn" data-style="traditional">
                            <span class="style-preview" style="background: linear-gradient(45deg, #ff6600, #ffcc00);"></span>
                            <span class="style-name">传统港式</span>
                        </button>
                        <button class="style-btn" data-style="abstract">
                            <span class="style-preview" style="background: linear-gradient(45deg, #00ff00, #ff00ff);"></span>
                            <span class="style-name">抽象艺术</span>
                        </button>
                        <button class="style-btn" data-style="minimal">
                            <span class="style-preview" style="background: linear-gradient(45deg, #ffffff, #888888);"></span>
                            <span class="style-name">极简风格</span>
                        </button>
                    </div>
                </div>

                <button id="graffiti-generate-btn" class="primary-btn">
                    <span>AI 生成</span>
                </button>
            </main>
        </div>

        <!-- AI涂鸦预览屏幕 -->
        <div id="graffiti-preview-screen" class="screen">
            <header class="screen-header">
                <button class="back-btn" data-screen="graffiti-input">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 12H5M12 19l-7-7 7-7"/>
                    </svg>
                </button>
                <h1>预览</h1>
                <div class="spacer"></div>
            </header>

            <main class="preview-content">
                <div id="graffiti-preview-container" class="preview-container">
                    <p class="preview-placeholder">AI 生成的涂鸦将显示在这里</p>
                </div>

                <div class="action-buttons">
                    <button id="graffiti-preview-btn" class="secondary-btn">
                        <span class="btn-icon">🖼️</span>
                        <span>桌面预览</span>
                    </button>
                    <button id="graffiti-ar-btn" class="ar-btn">
                        <span class="btn-icon">📷</span>
                        <span>AR模式</span>
                    </button>
                </div>
            </main>
        </div>

        <!-- 桌面预览屏幕 -->
        <div id="preview-screen" class="screen preview-mode">
            <div id="preview-container" class="preview-scene">
                <!-- Three.js 场景将在这里渲染 -->
            </div>

            <!-- 预览控制 -->
            <div class="preview-controls">
                <button id="preview-exit-btn" class="preview-btn">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 6L6 18M6 6l12 12"/>
                    </svg>
                    <span>返回</span>
                </button>
                <button id="preview-capture-btn" class="preview-btn">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/>
                        <circle cx="12" cy="13" r="4"/>
                    </svg>
                    <span>截图</span>
                </button>
                <div class="preview-hint">拖动调整位置 • 滚轮缩放</div>
            </div>
        </div>

        <!-- AR 屏幕容器 -->
        <div id="ar-screen" class="screen">
            <div id="ar-container"></div>

            <!-- AR UI 层 -->
            <div class="ar-overlay">
                <div class="ar-header">
                    <button id="ar-exit-btn" class="ar-btn-icon">
                        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                            <path d="M18 6L6 18M6 6l12 12"/>
                        </svg>
                    </button>
                    <button id="ar-capture-btn" class="ar-btn-icon camera-icon">
                        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/>
                            <circle cx="12" cy="13" r="4"/>
                        </svg>
                    </button>
                </div>

                <div class="ar-marker-hint" id="ar-marker-hint">
                    <div class="marker-frame">
                        <div class="marker-corner tl"></div>
                        <div class="marker-corner tr"></div>
                        <div class="marker-corner bl"></div>
                        <div class="marker-corner br"></div>
                        <img id="hiro-marker-img" src="https://raw.githubusercontent.com/AR-js-org/AR.js/master/data/images/hiro.png" alt="Hiro Marker" class="marker-image">
                    </div>
                    <p>将 Hiro 标记对准摄像头</p>
                    <button id="download-marker-btn" class="download-marker-btn">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                            <polyline points="7 10 12 15 17 10"/>
                            <line x1="12" y1="15" x2="12" y2="3"/>
                        </svg>
                        下载标记
                    </button>
                </div>

                <div class="ar-controls">
                    <button id="ar-place-btn" class="ar-control-btn">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
                        </svg>
                        <span>放置</span>
                    </button>
                    <button id="ar-reset-btn" class="ar-control-btn">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
                            <path d="M3 3v5h5"/>
                        </svg>
                        <span>重置</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 设置模态框 -->
    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <header class="modal-header">
                <h2>设置</h2>
                <button id="settings-close" class="modal-close">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 6L6 18M6 6l12 12"/>
                    </svg>
                </button>
            </header>

            <div class="modal-body">
                <div class="setting-group">
                    <label for="ai-provider-select">AI 服务提供商</label>
                    <select id="ai-provider-select">
                        <option value="HUGGINGFACE">Hugging Face（免费）</option>
                        <option value="USER_PROVIDED">用户 API Key</option>
                        <option value="ALIYUN">通义万相</option>
                        <option value="BAIDU">文心一格</option>
                    </select>
                </div>

                <div class="setting-group" id="api-key-group">
                    <label for="api-key-input">API Key</label>
                    <input type="password" id="api-key-input" placeholder="输入你的 API Key">
                    <p class="setting-hint">API Key 仅保存在本地，不会上传到服务器</p>
                </div>
            </div>

            <footer class="modal-footer">
                <button id="settings-save-btn" class="primary-btn">保存</button>
            </footer>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="js/config.js?v=2.3"></script>
    <script src="js/utils.js?v=2.3"></script>
    <script src="js/neon-pipe.js?v=2.3"></script>
    <script src="js/ai-service.js?v=2.3"></script>
    <script src="js/ar-manager.js?v=2.3"></script>
    <script src="js/preview-manager.js?v=2.3"></script>
    <script src="js/main.js?v=2.3"></script>
</body>
</html>
